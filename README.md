# go-websocket-benchmark
- support 1m-connections client

## nbio 1m-connections-benchmark
run:
```sh
git clone https://github.com/lesismal/go-websocket-benchmark.git
cd go-websocket-benchmark
./script/1m_conns_benchmark.sh
```

here is the result on my ubuntu vm:
```sh
--------------------------------------------------------------
BenchType  : Connections
Framework  : nbio_nonblocking
Connections: 1000000
Concurrency: 5000
Success    : 1000000
Failed     : 0
Used       : 41.56s
TPS        : 24061
Min        : 20ns
Avg        : 192.57ms
Max        : 41.52s
TP50       : 30ns
TP75       : 30ns
TP90       : 30ns
TP95       : 31ns
TP99       : 31ns
--------------------------------------------------------------
BenchType  : BenchEcho
Framework  : nbio_nonblocking
Conns      : 1000000
Concurrency: 50000
Payload    : 1024
Total      : 5000000
Success    : 5000000
Failed     : 0
Used       : 47.02s
CPU Min    : 0.00%
CPU Avg    : 340.08%
CPU Max    : 386.93%
MEM Min    : 1.76G
MEM Avg    : 1.91G
MEM Max    : 1.94G
TPS        : 106348
Min        : 436.16us
Avg        : 465.78ms
Max        : 2.42s
TP50       : 412.36ms
TP75       : 600.92ms
TP90       : 779.92ms
TP95       : 1.04s
TP99       : 1.35s
--------------------------------------------------------------------------
```

## benchmark for all frameworks
run:
```sh
git clone https://github.com/lesismal/go-websocket-benchmark.git
cd go-websocket-benchmark
./script/benchmarkN.sh

# if you want to change the benchmark config, just read the script and edit:
# go-websocket-benchmark/script/config.sh
```



Some benchmark results on my ubuntu vm:

|    Framework     | Conns | Concurrency | Payload |  Total  | Success | Failed |  Used  | CPU Min | CPU Avg | CPU Max | MEM Min | MEM Avg | MEM Max |  TPS   |   Min   |   Avg   |   Max    |  TP50   |  TP75   |  TP90   |  TP95   |  TP99   |
|     ---          |  ---  |     ---     |   ---   |   ---   |   ---   |  ---   |  ---   |   ---   |   ---   |   ---   |   ---   |   ---   |   ---   |  ---   |   ---   |   ---   |   ---    |   ---   |   ---   |   ---   |   ---   |   ---   |
|   fasthttp       | 5000  |    5000     |   512   | 2000000 | 2000000 |   0    | 8.81s  |  0.00   | 253.55  | 305.64  | 110.35M | 116.50M | 122.34M | 227037 | 13.54us | 21.99ms | 173.22ms | 20.96ms | 26.93ms | 34.80ms | 40.87ms | 53.00ms |
|    gobwas        | 5000  |    5000     |   512   | 2000000 | 2000000 |   0    | 10.38s | 119.89  | 314.48  | 355.94  | 48.59M  | 49.14M  | 49.38M  | 192630 | 25.14us | 25.90ms | 145.92ms | 24.24ms | 30.67ms | 40.04ms | 47.98ms | 71.16ms |
|    gorilla       | 5000  |    5000     |   512   | 2000000 | 2000000 |   0    | 8.72s  |  0.00   | 247.40  | 298.95  | 109.66M | 115.89M | 121.89M | 229291 | 11.77us | 21.76ms | 113.70ms | 21.02ms | 26.57ms | 34.45ms | 40.15ms | 54.68ms |
|     gws          | 5000  |    5000     |   512   | 2000000 | 2000000 |   0    | 8.46s  | 125.96  | 260.74  | 293.96  | 84.95M  | 87.63M  | 90.57M  | 236327 | 12.57us | 21.11ms | 122.54ms | 20.39ms | 26.01ms | 33.71ms | 39.07ms | 50.39ms |
|    gws_std       | 5000  |    5000     |   512   | 2000000 | 2000000 |   0    | 8.58s  | 162.76  | 266.11  | 299.96  | 137.68M | 154.97M | 172.57M | 232984 | 13.02us | 21.43ms | 126.51ms | 20.54ms | 26.43ms | 34.09ms | 40.02ms | 53.97ms |
|    hertz         | 5000  |    5000     |   512   | 2000000 | 2000000 |   0    | 9.62s  | 211.68  | 320.32  | 349.93  | 248.12M | 287.03M | 307.22M | 207848 | 20.69us | 24.01ms | 145.31ms | 23.11ms | 29.29ms | 36.92ms | 42.64ms | 57.42ms |
|   hertz_std      | 5000  |    5000     |   512   | 2000000 | 2000000 |   0    | 8.72s  |  0.00   | 258.01  | 314.82  | 153.48M | 159.48M | 165.15M | 229403 | 12.69us | 21.76ms | 119.60ms | 20.65ms | 26.86ms | 35.07ms | 40.78ms | 56.63ms |
|   nbio_std       | 5000  |    5000     |   512   | 2000000 | 2000000 |   0    | 8.43s  | 118.87  | 271.06  | 306.95  | 100.20M | 112.34M | 120.38M | 237357 | 15.00us | 21.04ms | 126.39ms | 20.08ms | 25.74ms | 33.19ms | 39.02ms | 53.45ms |
|  nbio_blocking   | 5000  |    5000     |   512   | 2000000 | 2000000 |   0    | 8.46s  | 132.80  | 276.17  | 304.95  | 94.09M  | 114.86M | 120.18M | 236352 | 14.08us | 21.11ms | 142.06ms | 20.12ms | 26.08ms | 33.77ms | 38.89ms | 52.54ms |
|   nbio_mixed     | 5000  |    5000     |   512   | 2000000 | 2000000 |   0    | 8.64s  | 174.96  | 280.20  | 305.95  | 99.80M  | 149.29M | 199.12M | 231512 | 14.64us | 21.56ms | 115.73ms | 20.55ms | 26.83ms | 34.94ms | 40.03ms | 52.95ms |
| nbio_nonblocking | 5000  |    5000     |   512   | 2000000 | 2000000 |   0    | 10.22s |  60.91  | 293.45  | 328.95  | 67.08M  | 76.64M  | 80.02M  | 195621 | 61.20us | 25.49ms | 147.35ms | 24.42ms | 31.48ms | 39.32ms | 45.08ms | 58.77ms |
|    nettyws       | 5000  |    5000     |   512   | 2000000 | 2000000 |   0    | 8.87s  |  0.00   | 295.44  | 356.94  | 144.62M | 152.53M | 154.78M | 225540 | 18.68us | 22.13ms | 137.54ms | 20.99ms | 27.61ms | 35.70ms | 41.32ms | 53.48ms |
|    nhooyr        | 5000  |    5000     |   512   | 2000000 | 2000000 |   0    | 9.65s  | 238.72  | 364.58  | 391.94  | 171.47M | 183.18M | 194.76M | 207206 | 23.22us | 24.10ms | 126.25ms | 22.95ms | 29.37ms | 37.25ms | 43.42ms | 56.18ms |


|    Framework     | Conns | Concurrency | Payload |  Total  | Success | Failed |  Used  | CPU Min | CPU Avg | CPU Max | MEM Min | MEM Avg | MEM Max |  TPS   |   Min   |   Avg   |   Max    |  TP50   |  TP75   |  TP90   |   TP95   |   TP99   |
|     ---          |  ---  |     ---     |   ---   |   ---   |   ---   |  ---   |  ---   |   ---   |   ---   |   ---   |   ---   |   ---   |   ---   |  ---   |   ---   |   ---   |   ---    |   ---   |   ---   |   ---   |   ---    |   ---    |
|   fasthttp       | 5000  |    5000     |  1024   | 2000000 | 2000000 |   0    | 9.29s  |  78.93  | 257.04  | 287.67  | 151.58M | 151.61M | 151.87M | 215210 | 15.58us | 23.19ms | 130.86ms | 22.06ms | 28.93ms | 37.15ms | 43.68ms  | 56.52ms  |
|    gobwas        | 5000  |    5000     |  1024   | 2000000 | 2000000 |   0    | 16.15s |  24.96  | 336.72  | 371.94  | 48.37M  | 49.57M  | 55.72M  | 123863 | 35.35us | 40.25ms | 485.88ms | 31.11ms | 44.68ms | 95.38ms | 122.25ms | 174.92ms |
|    gorilla       | 5000  |    5000     |  1024   | 2000000 | 2000000 |   0    | 9.48s  | 125.95  | 260.00  | 282.67  | 156.41M | 156.49M | 156.64M | 210963 | 15.52us | 23.66ms | 123.84ms | 22.29ms | 29.52ms | 38.24ms | 45.22ms  | 61.84ms  |
|     gws          | 5000  |    5000     |  1024   | 2000000 | 2000000 |   0    | 9.16s  |  33.99  | 244.30  | 277.08  | 87.57M  | 89.25M  | 90.92M  | 218353 | 13.75us | 22.87ms | 143.69ms | 21.56ms | 28.20ms | 36.97ms | 43.14ms  | 57.69ms  |
|    gws_std       | 5000  |    5000     |  1024   | 2000000 | 2000000 |   0    | 9.33s  |  89.94  | 252.98  | 276.96  | 169.14M | 171.10M | 172.99M | 214287 | 14.56us | 23.29ms | 149.71ms | 22.10ms | 28.75ms | 37.69ms | 44.60ms  | 58.83ms  |
|    hertz         | 5000  |    5000     |  1024   | 2000000 | 2000000 |   0    | 10.57s | 180.77  | 323.38  | 348.94  | 350.20M | 351.54M | 352.17M | 189169 | 20.88us | 26.39ms | 132.95ms | 25.09ms | 32.34ms | 40.89ms | 46.65ms  | 62.32ms  |
|   hertz_std      | 5000  |    5000     |  1024   | 2000000 | 2000000 |   0    | 9.51s  | 138.91  | 279.22  | 302.95  | 222.49M | 222.49M | 222.49M | 210406 | 14.92us | 23.71ms | 175.80ms | 22.40ms | 29.65ms | 38.13ms | 44.50ms  | 57.71ms  |
|   nbio_std       | 5000  |    5000     |  1024   | 2000000 | 2000000 |   0    | 9.17s  |  44.94  | 264.50  | 297.53  | 100.53M | 109.56M | 116.48M | 218021 | 15.14us | 22.90ms | 215.49ms | 21.56ms | 28.56ms | 37.42ms | 43.50ms  | 57.12ms  |
|  nbio_blocking   | 5000  |    5000     |  1024   | 2000000 | 2000000 |   0    | 9.32s  |  72.92  | 270.06  | 300.55  | 120.90M | 122.65M | 124.82M | 214547 | 16.45us | 23.28ms | 136.81ms | 22.03ms | 28.73ms | 37.75ms | 43.83ms  | 60.47ms  |
|   nbio_mixed     | 5000  |    5000     |  1024   | 2000000 | 2000000 |   0    | 9.30s  |  73.98  | 268.04  | 295.91  | 203.26M | 205.56M | 219.07M | 215056 | 15.03us | 23.21ms | 164.54ms | 21.96ms | 28.90ms | 37.69ms | 43.22ms  | 57.67ms  |
| nbio_nonblocking | 5000  |    5000     |  1024   | 2000000 | 2000000 |   0    | 10.79s |  0.00   | 287.07  | 329.96  | 80.02M  | 80.24M  | 80.33M  | 185422 | 47.20us | 26.92ms | 113.63ms | 25.86ms | 33.50ms | 41.38ms | 46.90ms  | 60.75ms  |
|    nettyws       | 5000  |    5000     |  1024   | 2000000 | 2000000 |   0    | 9.81s  |  0.00   | 292.30  | 337.94  | 152.49M | 158.26M | 160.03M | 203823 | 17.07us | 24.47ms | 152.48ms | 23.51ms | 30.16ms | 38.75ms | 44.89ms  | 57.50ms  |
|    nhooyr        | 5000  |    5000     |  1024   | 2000000 | 2000000 |   0    | 10.71s |  0.00   | 330.32  | 386.16  | 188.01M | 201.00M | 213.34M | 186713 | 19.75us | 26.73ms | 158.23ms | 25.57ms | 32.99ms | 42.05ms | 47.96ms  | 61.02ms  |


|    Framework     | Conns | Concurrency | Payload |  Total  | Success | Failed |  Used  | CPU Min | CPU Avg | CPU Max | MEM Min | MEM Avg | MEM Max |  TPS   |   Min    |   Avg    |   Max    |   TP50   |   TP75   |   TP90   |   TP95   |   TP99   |
|     ---          |  ---  |     ---     |   ---   |   ---   |   ---   |  ---   |  ---   |   ---   |   ---   |   ---   |   ---   |   ---   |   ---   |  ---   |   ---    |   ---    |   ---    |   ---    |   ---    |   ---    |   ---    |   ---    |
|   fasthttp       | 50000 |    50000    |   512   | 2000000 | 2000000 |   0    | 9.59s  | 155.74  | 316.03  | 353.96  |  1.00G  |  1.01G  |  1.01G  | 208463 | 672.84us | 235.63ms | 446.77ms | 232.50ms | 267.24ms | 301.28ms | 320.97ms | 365.59ms |
|    gobwas        | 50000 |    50000    |   512   | 2000000 | 2000000 |   0    | 10.86s |  0.00   | 351.79  | 398.94  | 393.80M | 393.80M | 393.80M | 184163 |  1.94ms  | 265.71ms | 685.03ms | 260.58ms | 296.02ms | 338.06ms | 369.09ms | 460.10ms |
|    gorilla       | 50000 |    50000    |   512   | 2000000 | 2000000 |   0    | 9.57s  | 152.92  | 313.11  | 345.89  |  1.00G  |  1.01G  |  1.01G  | 209054 | 90.90us  | 232.98ms | 510.78ms | 230.23ms | 261.17ms | 297.05ms | 326.64ms | 383.13ms |
|     gws          | 50000 |    50000    |   512   | 2000000 | 2000000 |   0    | 9.34s  |  49.97  | 284.29  | 337.62  | 557.71M | 599.16M | 617.80M | 214198 | 56.99us  | 227.94ms | 474.82ms | 226.45ms | 256.52ms | 284.08ms | 305.77ms | 359.43ms |
|    gws_std       | 50000 |    50000    |   512   | 2000000 | 2000000 |   0    | 9.39s  |  81.86  | 301.17  | 336.95  |  1.05G  |  1.08G  |  1.13G  | 213103 | 187.38us | 229.65ms | 521.65ms | 222.61ms | 259.26ms | 298.21ms | 322.49ms | 372.97ms |
|    hertz         | 50000 |    50000    |   512   | 2000000 | 2000000 |   0    | 12.62s | 196.84  | 319.75  | 353.96  |  2.05G  |  2.10G  |  2.14G  | 158421 | 213.72us | 307.07ms | 863.56ms | 277.44ms | 323.82ms | 469.88ms | 516.49ms | 602.03ms |
|   hertz_std      | 50000 |    50000    |   512   | 2000000 | 2000000 |   0    | 9.41s  |  94.94  | 323.60  | 371.58  |  1.35G  |  1.35G  |  1.36G  | 212503 | 759.58us | 229.96ms | 487.21ms | 226.63ms | 257.04ms | 288.95ms | 310.91ms | 357.82ms |
|   nbio_std       | 50000 |    50000    |   512   | 2000000 | 2000000 |   0    | 9.11s  |  0.00   | 294.70  | 343.96  | 702.45M | 724.03M | 767.18M | 219637 | 218.59us | 222.54ms | 559.36ms | 218.14ms | 250.63ms | 282.07ms | 306.18ms | 367.30ms |
|  nbio_blocking   | 50000 |    50000    |   512   | 2000000 | 2000000 |   0    | 9.23s  |  12.99  | 305.90  | 354.47  | 565.89M | 616.98M | 654.36M | 216751 | 60.58us  | 226.17ms | 505.45ms | 219.81ms | 254.94ms | 292.15ms | 319.33ms | 368.63ms |
|   nbio_mixed     | 50000 |    50000    |   512   | 2000000 | 2000000 |   0    | 10.52s | 162.94  | 339.68  | 367.94  | 338.53M | 398.62M | 413.24M | 190132 | 319.82us | 257.71ms |  1.15s   | 217.85ms | 284.30ms | 384.32ms | 703.52ms | 872.24ms |
| nbio_nonblocking | 50000 |    50000    |   512   | 2000000 | 2000000 |   0    | 10.53s | 173.81  | 341.98  | 367.93  | 177.88M | 192.83M | 198.71M | 189846 | 650.61us | 257.19ms | 861.56ms | 246.61ms | 294.02ms | 358.51ms | 418.57ms | 531.04ms |
|    nettyws       | 50000 |    50000    |   512   | 2000000 | 2000000 |   0    | 10.43s | 120.85  | 366.20  | 399.37  |  1.04G  |  1.15G  |  1.29G  | 191729 | 697.76us | 255.90ms | 526.77ms | 252.98ms | 285.52ms | 325.63ms | 350.41ms | 405.57ms |
|    nhooyr        | 50000 |    50000    |   512   | 2000000 | 2000000 |   0    | 11.37s | 118.91  | 372.23  | 398.93  |  1.57G  |  1.58G  |  1.59G  | 175971 |  1.06ms  | 276.70ms | 556.31ms | 274.38ms | 299.59ms | 325.29ms | 348.44ms | 401.14ms |


|    Framework     | Conns | Concurrency | Payload |  Total  | Success | Failed |  Used  | CPU Min | CPU Avg | CPU Max | MEM Min | MEM Avg | MEM Max |  TPS   |   Min    |   Avg    |   Max    |   TP50   |   TP75   |   TP90   |   TP95   |   TP99   |
|     ---          |  ---  |     ---     |   ---   |   ---   |   ---   |  ---   |  ---   |   ---   |   ---   |   ---   |   ---   |   ---   |   ---   |  ---   |   ---    |   ---    |   ---    |   ---    |   ---    |   ---    |   ---    |   ---    |
|   fasthttp       | 50000 |    50000    |  1024   | 2000000 | 2000000 |   0    | 10.86s |  0.00   | 285.04  | 334.83  |  1.19G  |  1.20G  |  1.20G  | 184190 | 474.62us | 266.10ms | 590.88ms | 262.75ms | 300.27ms | 336.56ms | 360.62ms | 416.60ms |
|    gobwas        | 50000 |    50000    |  1024   | 2000000 | 2000000 |   0    | 15.19s |  67.97  | 371.30  | 398.05  | 394.43M | 394.43M | 394.43M | 131685 | 67.14us  | 371.38ms | 621.82ms | 376.92ms | 393.27ms | 412.80ms | 431.02ms | 501.39ms |
|    gorilla       | 50000 |    50000    |  1024   | 2000000 | 2000000 |   0    | 10.33s |  23.96  | 292.07  | 335.95  |  1.77G  |  1.77G  |  1.77G  | 193585 | 583.91us | 252.95ms | 546.23ms | 249.28ms | 283.45ms | 316.88ms | 337.06ms | 403.51ms |
|     gws          | 50000 |    50000    |  1024   | 2000000 | 2000000 |   0    | 9.82s  |  0.00   | 267.33  | 330.68  | 722.02M | 723.50M | 733.49M | 203663 | 57.30us  | 240.82ms | 481.35ms | 238.07ms | 270.03ms | 302.99ms | 323.48ms | 363.92ms |
|    gws_std       | 50000 |    50000    |  1024   | 2000000 | 2000000 |   0    | 9.76s  |  0.00   | 273.99  | 331.95  |  1.39G  |  1.39G  |  1.39G  | 204857 | 381.02us | 239.33ms | 500.62ms | 234.79ms | 270.55ms | 305.55ms | 330.23ms | 383.82ms |
|    hertz         | 50000 |    50000    |  1024   | 2000000 | 2000000 |   0    | 13.16s |  45.98  | 298.22  | 332.32  |  2.74G  |  2.79G  |  2.85G  | 151970 | 18.30ms  | 321.49ms | 853.26ms | 289.65ms | 314.86ms | 530.60ms | 562.90ms | 616.33ms |
|   hertz_std      | 50000 |    50000    |  1024   | 2000000 | 2000000 |   0    | 10.08s |  0.00   | 324.91  | 379.95  |  1.73G  |  1.73G  |  1.73G  | 198317 | 278.06us | 246.62ms | 529.95ms | 242.94ms | 278.08ms | 313.84ms | 334.51ms | 371.31ms |
|   nbio_std       | 50000 |    50000    |  1024   | 2000000 | 2000000 |   0    | 9.77s  |  0.00   | 282.36  | 347.65  | 721.96M | 724.28M | 724.76M | 204652 |  5.08ms  | 239.94ms | 521.49ms | 237.47ms | 267.97ms | 300.93ms | 322.00ms | 360.49ms |
|  nbio_blocking   | 50000 |    50000    |  1024   | 2000000 | 2000000 |   0    | 9.77s  |  0.00   | 297.47  | 357.54  | 674.52M | 732.30M | 786.37M | 204706 | 249.79us | 240.04ms | 482.05ms | 238.59ms | 269.63ms | 301.25ms | 320.59ms | 354.74ms |
|   nbio_mixed     | 50000 |    50000    |  1024   | 2000000 | 2000000 |   0    | 11.23s |  56.91  | 330.72  | 379.94  | 537.72M | 542.00M | 569.14M | 178023 | 20.79ms  | 274.10ms |  1.10s   | 233.19ms | 293.63ms | 406.34ms | 709.66ms | 873.43ms |
| nbio_nonblocking | 50000 |    50000    |  1024   | 2000000 | 2000000 |   0    | 11.12s |  32.98  | 330.72  | 370.94  | 180.21M | 200.46M | 205.17M | 179776 | 474.58us | 273.26ms | 704.93ms | 264.23ms | 312.75ms | 389.26ms | 445.25ms | 537.87ms |
|    nettyws       | 50000 |    50000    |  1024   | 2000000 | 2000000 |   0    | 11.04s |  0.00   | 352.26  | 400.91  |  1.08G  |  1.23G  |  1.30G  | 181139 | 101.83us | 270.37ms | 643.07ms | 265.58ms | 306.69ms | 341.23ms | 366.41ms | 440.76ms |
|    nhooyr        | 50000 |    50000    |  1024   | 2000000 | 2000000 |   0    | 12.34s | 124.89  | 375.45  | 400.38  |  1.72G  |  1.73G  |  1.74G  | 162104 | 154.26us | 301.29ms | 548.44ms | 297.78ms | 328.81ms | 367.04ms | 387.95ms | 452.46ms |

